formula = r"""
class Aubio < Formula
  desc "Extract annotations from audio signals"
  homepage "https://aubio.org/"
  url "https://aubio.org/pub/aubio-0.4.9.tar.bz2"
  sha256 "d48282ae4dab83b3dc94c16cf011bcb63835c1c02b515490e1883049c3d1f3da"
  revision 2

  livecheck do
    url "https://aubio.org/pub/"
    regex(/href=.*?aubio[._-]v?(\d+(?:\.\d+)+)\.t/i)
  end

  bottle do
    sha256 cellar: :any, arm64_big_sur: "f6db53233e1b2855491b4b9310a579e4ac51c3dab7ac426f5c1c64b2fc0820f0"
    sha256 cellar: :any, big_sur:       "53bc8066ab50f4e4c24aad5f31e96f1ce0abac84930e5fcce43fa8f6083a878e"
    sha256 cellar: :any, catalina:      "9b24159cf4c8adbb1a78c5cab192453ebebd47260612d38005683ff093250b45"
    sha256 cellar: :any, mojave:        "653f41a951b87cf01049ed6a7019a3d2c96e635fc16d3be4d5edf3225b0a5f52"
    sha256 cellar: :any, high_sierra:   "d6cc3ba3c3a257f4d5b4c1c3a9c0c8cca4fccf09ffc682901888d26c039886a8"
  end

  depends_on "libtool" => :build
  depends_on "pkg-config" => :build
  depends_on "numpy"
  depends_on "python@3.9"

  def install
    # Needed due to issue with recent clang (-fno-fused-madd))
    ENV.refurbish_args

    system Formula["python@3.9"].opt_bin/"python3", "./waf", "configure", "--prefix=#{prefix}"
    system Formula["python@3.9"].opt_bin/"python3", "./waf", "build"
    system Formula["python@3.9"].opt_bin/"python3", "./waf", "install"

    system Formula["python@3.9"].opt_bin/"python3", *Language::Python.setup_install_args(prefix)
    bin.env_script_all_files(libexec/"bin", PYTHONPATH: ENV["PYTHONPATH"])
  end

  test do
    system "#{bin}/aubiocut", "--verbose", "/System/Library/Sounds/Glass.aiff"
    system "#{bin}/aubioonset", "--verbose", "/System/Library/Sounds/Glass.aiff"
  end
end

"""

import "homebrew-install" as hi

import "bzip2" as i0, "cmake" as i1, "cython" as i2, "expat" as i3, "gcc" as i4, "gdbm" as i5, "gmp" as i6, "isl" as i7, "libffi" as i8, "libmpc" as i9, "libtool" as i10, "m4" as i11, "mpdecimal" as i12, "mpfr" as i13, "ncurses" as i14, "numpy" as i15, "openblas" as i16, "openssl@1.1" as i17, "pkg-config" as i18, "python@3.9" as i19, "readline" as i20, "sphinx-doc" as i21, "sqlite" as i22, "unzip" as i23, "xz" as i24, "zip" as i25, "zlib" as i26, "zstd" as i27

pkg(
  name: "aubio",
  version: "0.4.9",
  dependencies: [hi, i0, i1, i2, i3, i4, i5, i6, i7, i8, i9, i10, i11, i12, i13, i14, i15, i16, i17, i18, i19, i20, i21, i22, i23, i24, i25, i26, i27],

  def install(ctx) {
    ctx.write_file(join(ctx.build, "aubio.rb"), formula)
    ctx.system("homebrew-install", ctx.prefix, ctx.state_dir, "./aubio.rb")
  }
)
