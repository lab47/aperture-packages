formula = r"""
class Gpgme < Formula
  desc "Library access to GnuPG"
  homepage "https://www.gnupg.org/related_software/gpgme/"
  url "https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-1.15.1.tar.bz2"
  sha256 "eebc3c1b27f1c8979896ff361ba9bb4778b508b2496c2fc10e3775a40b1de1ad"
  license "LGPL-2.1-or-later"

  livecheck do
    url "https://gnupg.org/ftp/gcrypt/gpgme/"
    regex(/href=.*?gpgme[._-]v?(\d+(?:\.\d+)+)\.t/i)
  end

  bottle do
    sha256 cellar: :any, arm64_big_sur: "cb5bc3ae542bb57f6eb2ba0ec5e2980f34d43cfbaa1349a77c50b0caba2d2b69"
    sha256 cellar: :any, big_sur:       "b7db3dbcd653200ed5f08789582d27f5ada1d70373fc0deaa908167869415362"
    sha256 cellar: :any, catalina:      "d2f6e379b0c47d4b62275a588a69bd08fb1c79e153b348c96280f3162548a1e4"
    sha256 cellar: :any, mojave:        "4a783a98f9f37a905e5864a628fcbb955ee9f3fa5ddab7c95edad62abe38697f"
  end

  depends_on "python@3.9" => [:build, :test]
  depends_on "swig" => :build
  depends_on "gnupg"
  depends_on "libassuan"
  depends_on "libgpg-error"

  def install
    ENV["PYTHON"] = Formula["python@3.9"].opt_bin/"python3"

    system "./configure", "--disable-dependency-tracking",
                          "--disable-silent-rules",
                          "--prefix=#{prefix}",
                          "--enable-static"
    system "make"
    system "make", "install"

    # avoid triggering mandatory rebuilds of software that hard-codes this path
    inreplace bin/"gpgme-config", prefix, opt_prefix
  end

  test do
    assert_match version.to_s, shell_output("#{bin}/gpgme-tool --lib-version")
    system Formula["python@3.9"].opt_bin/"python3", "-c", "import gpg; print(gpg.version.versionstr)"
  end
end

"""

import "homebrew-install" as hi

import "autoconf" as i0, "automake" as i1, "bdw-gc" as i2, "c-ares" as i3, "cmake" as i4, "gdbm" as i5, "gettext" as i6, "gmp" as i7, "gnu-sed" as i8, "gnupg" as i9, "gnutls" as i10, "guile" as i11, "jemalloc" as i12, "libassuan" as i13, "libatomic_ops" as i14, "libev" as i15, "libevent" as i16, "libffi" as i17, "libgcrypt" as i18, "libgpg-error" as i19, "libidn2" as i20, "libksba" as i21, "libtasn1" as i22, "libtool" as i23, "libunistring" as i24, "libusb" as i25, "m4" as i26, "mpdecimal" as i27, "nettle" as i28, "nghttp2" as i29, "ninja" as i30, "npth" as i31, "openssl@1.1" as i32, "p11-kit" as i33, "pcre" as i34, "pinentry" as i35, "pkg-config" as i36, "python@3.9" as i37, "readline" as i38, "sphinx-doc" as i39, "sqlite" as i40, "swig" as i41, "unbound" as i42, "xz" as i43

pkg(
  name: "gpgme",
  version: "1.15.1",
  dependencies: [hi, i0, i1, i2, i3, i4, i5, i6, i7, i8, i9, i10, i11, i12, i13, i14, i15, i16, i17, i18, i19, i20, i21, i22, i23, i24, i25, i26, i27, i28, i29, i30, i31, i32, i33, i34, i35, i36, i37, i38, i39, i40, i41, i42, i43],

  def install(ctx) {
    ctx.write_file(join(ctx.build, "gpgme.rb"), formula)
    ctx.system("homebrew-install", ctx.prefix, ctx.state_dir, "./gpgme.rb")
  }
)
