def args(prefix) {
  [
    "-DCMAKE_C_FLAGS_RELEASE=-DNDEBUG",
    "-DCMAKE_CXX_FLAGS_RELEASE=-DNDEBUG",
    "-DCMAKE_INSTALL_PREFIX="+prefix,
    "-DCMAKE_BUILD_TYPE=Release",
    "-DCMAKE_FIND_FRAMEWORK=LAST",
    "-DCMAKE_VERBOSE_MAKEFILE=ON",
    "-Wno-dev",
  ]
}

def cmake(ctx, target=".", extra=[], prefix=None) {
  if not prefix {
    prefix = ctx.prefix
  }

  opts = extra + args(prefix)
  ctx.system("cmake", target, *opts)
}
